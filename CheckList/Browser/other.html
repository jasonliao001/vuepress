<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebSocket | bxliao</title>
    <meta name="description" content="记录，分享，技术成长">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/vuepress/assets/css/0.styles.379a8785.css" as="style"><link rel="preload" href="/vuepress/assets/js/app.0ad50b13.js" as="script"><link rel="preload" href="/vuepress/assets/js/2.7cf59c07.js" as="script"><link rel="preload" href="/vuepress/assets/js/19.2b4db5f2.js" as="script"><link rel="prefetch" href="/vuepress/assets/js/10.7051dd6d.js"><link rel="prefetch" href="/vuepress/assets/js/11.b78552fe.js"><link rel="prefetch" href="/vuepress/assets/js/12.a3f37b4e.js"><link rel="prefetch" href="/vuepress/assets/js/13.48c60c84.js"><link rel="prefetch" href="/vuepress/assets/js/14.9e1e07a4.js"><link rel="prefetch" href="/vuepress/assets/js/15.f6563af8.js"><link rel="prefetch" href="/vuepress/assets/js/16.885f059c.js"><link rel="prefetch" href="/vuepress/assets/js/17.87c57e56.js"><link rel="prefetch" href="/vuepress/assets/js/18.e66fe3ad.js"><link rel="prefetch" href="/vuepress/assets/js/20.abe09e2f.js"><link rel="prefetch" href="/vuepress/assets/js/21.3b91fe73.js"><link rel="prefetch" href="/vuepress/assets/js/22.af4af1a8.js"><link rel="prefetch" href="/vuepress/assets/js/23.1fcfe0b9.js"><link rel="prefetch" href="/vuepress/assets/js/24.d7c1f4a8.js"><link rel="prefetch" href="/vuepress/assets/js/25.5121739d.js"><link rel="prefetch" href="/vuepress/assets/js/26.2818839b.js"><link rel="prefetch" href="/vuepress/assets/js/27.038138bf.js"><link rel="prefetch" href="/vuepress/assets/js/28.e093f550.js"><link rel="prefetch" href="/vuepress/assets/js/29.a161cf3a.js"><link rel="prefetch" href="/vuepress/assets/js/3.18ebda36.js"><link rel="prefetch" href="/vuepress/assets/js/30.98045800.js"><link rel="prefetch" href="/vuepress/assets/js/31.0bea32d9.js"><link rel="prefetch" href="/vuepress/assets/js/32.9a1237d0.js"><link rel="prefetch" href="/vuepress/assets/js/33.ddac3cbe.js"><link rel="prefetch" href="/vuepress/assets/js/34.1a746ae0.js"><link rel="prefetch" href="/vuepress/assets/js/35.6a085065.js"><link rel="prefetch" href="/vuepress/assets/js/36.b095d317.js"><link rel="prefetch" href="/vuepress/assets/js/37.e495042e.js"><link rel="prefetch" href="/vuepress/assets/js/38.741b638e.js"><link rel="prefetch" href="/vuepress/assets/js/39.f5a3030f.js"><link rel="prefetch" href="/vuepress/assets/js/4.bd5ca72f.js"><link rel="prefetch" href="/vuepress/assets/js/40.3d6f9139.js"><link rel="prefetch" href="/vuepress/assets/js/41.df7b5653.js"><link rel="prefetch" href="/vuepress/assets/js/42.27050bb2.js"><link rel="prefetch" href="/vuepress/assets/js/43.b57cfb1a.js"><link rel="prefetch" href="/vuepress/assets/js/44.c3831e0d.js"><link rel="prefetch" href="/vuepress/assets/js/45.2584058d.js"><link rel="prefetch" href="/vuepress/assets/js/46.e3f413fd.js"><link rel="prefetch" href="/vuepress/assets/js/47.80a9ca21.js"><link rel="prefetch" href="/vuepress/assets/js/48.62d46beb.js"><link rel="prefetch" href="/vuepress/assets/js/49.11254305.js"><link rel="prefetch" href="/vuepress/assets/js/5.22c734f0.js"><link rel="prefetch" href="/vuepress/assets/js/50.f4596a9b.js"><link rel="prefetch" href="/vuepress/assets/js/51.f1332ae8.js"><link rel="prefetch" href="/vuepress/assets/js/52.a9c597c8.js"><link rel="prefetch" href="/vuepress/assets/js/53.46cf4878.js"><link rel="prefetch" href="/vuepress/assets/js/54.5fb2dd96.js"><link rel="prefetch" href="/vuepress/assets/js/55.3f528df2.js"><link rel="prefetch" href="/vuepress/assets/js/56.5b4f961b.js"><link rel="prefetch" href="/vuepress/assets/js/57.a9ff1efc.js"><link rel="prefetch" href="/vuepress/assets/js/58.6233a362.js"><link rel="prefetch" href="/vuepress/assets/js/59.72925434.js"><link rel="prefetch" href="/vuepress/assets/js/6.a7451eec.js"><link rel="prefetch" href="/vuepress/assets/js/60.60f12184.js"><link rel="prefetch" href="/vuepress/assets/js/61.b887e966.js"><link rel="prefetch" href="/vuepress/assets/js/62.70d1255f.js"><link rel="prefetch" href="/vuepress/assets/js/7.e2975a0c.js"><link rel="prefetch" href="/vuepress/assets/js/8.69ee3e3f.js"><link rel="prefetch" href="/vuepress/assets/js/9.1c6ab7d2.js">
    <link rel="stylesheet" href="/vuepress/assets/css/0.styles.379a8785.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress/" class="home-link router-link-active"><!----> <span class="site-name">bxliao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress/SiteNav/recommend.html" class="nav-link">
  网址导航
</a></div><div class="nav-item"><a href="/vuepress/CheckList/Javascript/grammar.html" class="nav-link">
  前端大全
</a></div><div class="nav-item"><a href="/vuepress/Node/basic.html" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/vuepress/Computer/Linux.html" class="nav-link">
  计算机知识
</a></div><div class="nav-item"><a href="/vuepress/Algorithm/DataStruct.html" class="nav-link">
  设计模式与算法
</a></div><div class="nav-item"><a href="/vuepress/About.html" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress/SiteNav/recommend.html" class="nav-link">
  网址导航
</a></div><div class="nav-item"><a href="/vuepress/CheckList/Javascript/grammar.html" class="nav-link">
  前端大全
</a></div><div class="nav-item"><a href="/vuepress/Node/basic.html" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/vuepress/Computer/Linux.html" class="nav-link">
  计算机知识
</a></div><div class="nav-item"><a href="/vuepress/Algorithm/DataStruct.html" class="nav-link">
  设计模式与算法
</a></div><div class="nav-item"><a href="/vuepress/About.html" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Browser</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress/CheckList/Browser/chrome.html" class="sidebar-link">Chrome发展历程</a></li><li><a href="/vuepress/CheckList/Browser/router.html" class="sidebar-link">路由变迁</a></li><li><a href="/vuepress/CheckList/Browser/chrome01.html" class="sidebar-link">数据交流</a></li><li><a href="/vuepress/CheckList/Browser/chrome02.html" class="sidebar-link">渲染流程</a></li><li><a href="/vuepress/CheckList/Browser/chrome03.html" class="sidebar-link">V8 工作原理</a></li><li><a href="/vuepress/CheckList/Browser/chrome04.html" class="sidebar-link">Javascript 执行机制</a></li><li><a href="/vuepress/CheckList/Browser/chrome05.html" class="sidebar-link">页面循环系统</a></li><li><a href="/vuepress/CheckList/Browser/ajax.html" class="sidebar-link">网络请求</a></li><li><a href="/vuepress/CheckList/Browser/window.html" class="sidebar-link">Window</a></li><li><a href="/vuepress/CheckList/Browser/dom.html" class="sidebar-link">Dom</a></li><li><a href="/vuepress/CheckList/Browser/event.html" class="sidebar-link">Event</a></li><li><a href="/vuepress/CheckList/Browser/other.html" class="active sidebar-link">其他</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress/CheckList/Browser/other.html#websocket" class="sidebar-link">WebSocket</a></li><li class="sidebar-sub-header"><a href="/vuepress/CheckList/Browser/other.html#web-notifications-api" class="sidebar-link">Web Notifications API</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端规范</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端框架</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="websocket"><a href="#websocket" class="header-anchor">#</a> WebSocket</h2> <h4 id="为什么要有websocket？"><a href="#为什么要有websocket？" class="header-anchor">#</a> 为什么要有WebSocket？</h4> <p>因为 HTTP 协议有一个缺陷：通信只能由客户端发起。</p> <p>特点：</p> <p>（1）建立在 TCP 协议之上，服务器端的实现比较容易。</p> <p>（2）与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。</p> <p>（3）数据格式比较轻量，性能开销小，通信高效。</p> <p>（4）可以发送文本，也可以发送二进制数据。</p> <p>（5）没有同源限制，客户端可以与任意服务器通信，完全可以取代 Ajax。</p> <p>（6）协议标识符是<code>ws</code>（如果加密，则为<code>wss</code>，对应 HTTPS 协议），服务器网址就是 URL。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'wss://echo.websocket.org'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Connection open ...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello WebSockets!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received Message: '</span> <span class="token operator">+</span> evt<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Connection closed.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="websocket-readystate"><a href="#websocket-readystate" class="header-anchor">#</a> webSocket.readyState</h4> <ul><li>CONNECTING：值为0，表示正在连接。</li> <li>OPEN：值为1，表示连接成功，可以通信了。</li> <li>CLOSING：值为2，表示连接正在关闭。</li> <li>CLOSED：值为3，表示连接已经关闭，或者打开连接失败。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">switch</span> <span class="token punctuation">(</span>ws<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CONNECTING</span><span class="token operator">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">OPEN</span><span class="token operator">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CLOSING</span><span class="token operator">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CLOSED</span><span class="token operator">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">default</span><span class="token operator">:</span>
    <span class="token comment">// this never happens</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="web-notifications-api"><a href="#web-notifications-api" class="header-anchor">#</a> Web Notifications API</h2> <blockquote><p>Notification API 是浏览器的通知接口，用于在用户的桌面（而不是网页上）显示通知信息，桌面电脑和手机都适用，比如通知用户收到了一封 Email。具体的实现形式由浏览器自行部署，对于手机来说，一般显示在顶部的通知栏。</p> <p>如果网页代码调用这个API，浏览器会询问用户是否接受。只有在用户同意的情况下，通知信息才会显示。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>Notification <span class="token operator">&amp;&amp;</span> Notification<span class="token punctuation">.</span>permission <span class="token operator">!==</span> <span class="token string">&quot;denied&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">status</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">'通知标题'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> body<span class="token operator">:</span> <span class="token string">'这里是通知内容！'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="notification对象的属性和方法"><a href="#notification对象的属性和方法" class="header-anchor">#</a> Notification对象的属性和方法</h3> <h4 id="notification-permission"><a href="#notification-permission" class="header-anchor">#</a> Notification.permission</h4> <p>Notification.permission属性，用于读取用户给予的权限，它是一个只读属性，它有三种状态。</p> <ul><li>default：用户还没有做出任何许可，因此不会弹出通知。</li> <li>granted：用户明确同意接收通知。</li> <li>denied：用户明确拒绝接收通知。</li></ul> <h4 id="notification-requestpermission"><a href="#notification-requestpermission" class="header-anchor">#</a> Notification.requestPermission()</h4> <p>Notification.requestPermission方法用于让用户做出选择，到底是否接收通知。它的参数是一个回调函数，该函数可以接收用户授权状态作为参数。</p> <div class="language- extra-class"><pre class="language-text"><code>Notification.requestPermission(function (status) {
  if (status === &quot;granted&quot;) {
    var n = new Notification(&quot;Hi!&quot;);
  } else {
    alert(&quot;Hi!&quot;);
  }
});
</code></pre></div><h4 id="notification构造函数"><a href="#notification构造函数" class="header-anchor">#</a> Notification构造函数</h4> <div class="language- extra-class"><pre class="language-text"><code>var notification = new Notification('收到新邮件', {
  body: '您总共有3封未读邮件。'
});

notification.title // &quot;收到新邮件&quot;
notification.body // &quot;您总共有3封未读邮件。&quot;
</code></pre></div><h4 id="实例对象的事件"><a href="#实例对象的事件" class="header-anchor">#</a> 实例对象的事件</h4> <ul><li>show：通知显示给用户时触发。</li> <li>click：用户点击通知时触发。</li> <li>close：用户关闭通知时触发。</li> <li>error：通知出错时触发（大多数发生在通知无法正确显示时）。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress/CheckList/Browser/event.html" class="prev">
        Event
      </a></span> <span class="next"><a href="/vuepress/CheckList/Rule/ide.html">
        IDE
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress/assets/js/app.0ad50b13.js" defer></script><script src="/vuepress/assets/js/2.7cf59c07.js" defer></script><script src="/vuepress/assets/js/19.2b4db5f2.js" defer></script>
  </body>
</html>
